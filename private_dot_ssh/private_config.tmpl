# -----------------------------------------------------------------------------
# ğŸ” SSH Configuration Master File
# -----------------------------------------------------------------------------
#
# This configuration uses a structured, modular layout to manage multiple
# YubiKey-based and fallback SSH identities across work, personal, and secure
# environments. It leverages OpenSSH's `Include` directive to split settings
# into clearly scoped files for readability and easier automation.
#
# -----------------------------------------------------------------------------
# ğŸ—‚ï¸ Directory Layout: ~/.ssh/
#
# All keys and configs are organized into subfolders:
#
# ~/.ssh/
# â”œâ”€â”€ config                         â† This master file
# â”œâ”€â”€ config.d/                      â† Modular per-host configs
# â”‚   â”œâ”€â”€ github.conf
# â”‚   â”œâ”€â”€ spouterinn.conf
# â”‚   â””â”€â”€ fallback.conf
# â”œâ”€â”€ known_hosts
# â”œâ”€â”€ work/
# â”‚   â”œâ”€â”€ andy-anywhere              â† Legacy fallback key (ED25519)
# â”‚   â””â”€â”€ andy-anywhere.pub
# â”œâ”€â”€ yubikey/
# â”‚   â”œâ”€â”€ red_yubi_1/
# â”‚   â”‚   â”œâ”€â”€ id_red_yubi_1_sk             â† Primary non-resident key
# â”‚   â”‚   â”œâ”€â”€ id_red_yubi_1_sk.pub
# â”‚   â”‚   â””â”€â”€ id_red_yubi_1_sk_resident    â† Primary resident fallback
# â”‚   â””â”€â”€ red_yubi_2/
# â”‚       â”œâ”€â”€ id_red_yubi_2_sk             â† Backup non-resident key
# â”‚       â”œâ”€â”€ id_red_yubi_2_sk.pub
# â”‚       â””â”€â”€ id_red_yubi_2_sk_resident    â† Backup resident fallback
#
# -----------------------------------------------------------------------------
# ğŸ” Permissions Required:
#
# Directories: 700
#   chmod 700 ~/.ssh ~/.ssh/config.d ~/.ssh/work ~/.ssh/yubikey ~/.ssh/yubikey/*
#
# Private keys: 600
#   chmod 600 ~/.ssh/**/*.sk ~/.ssh/**/*.pub ~/.ssh/work/andy-anywhere
#
# -----------------------------------------------------------------------------
# ğŸ§  Fallback Behavior:
#
# The YubiKey loader in ~/.zshrc checks which key is available at login:
#   - red_yubi_1 â†’ preferred key
#   - red_yubi_2 â†’ alternate backup key
#   - andy-anywhere â†’ fallback if no hardware key is available
#
# These keys are added to `ssh-agent` based on detection logic.
#
# -----------------------------------------------------------------------------
# ğŸ“ Host Configuration: Modular Includes
#
# The following line pulls in host-specific settings from ~/.ssh/config.d/*.conf.
# Each file contains IdentityFile and connection options for one environment.
# -----------------------------------------------------------------------------

Include ~/.ssh/config.d/*.conf

# -----------------------------------------------------------------------------
# ğŸ”§ Global Defaults
# -----------------------------------------------------------------------------
# These apply to all SSH connections, unless overridden by a specific host block.
# -----------------------------------------------------------------------------

Host *
  UserKnownHostsFile ~/.ssh/known_hosts_ca ~/.ssh/known_hosts
  IdentityFile ~/.ssh/andy-anywhere
  User maeick
  IdentitiesOnly yes
  ForwardAgent no
  StrictHostKeyChecking ask
